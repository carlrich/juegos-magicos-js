<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Encuentra la Imagen</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Fredoka', sans-serif; }

    /* Fondo animado suave */
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .bg-animated {
      background: linear-gradient(-45deg, #a78bfa, #818cf8, #34d399, #60a5fa);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
    }

    /* Animaci√≥n del objetivo flotante */
    .floating-target {
      animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0px) scale(1); }
      50% { transform: translateY(-10px) scale(1.05); }
    }

    /* Animaci√≥n de entrada de las opciones */
    .pop-in { 
      animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; 
      opacity: 0; 
      transform: scale(0.5); 
    }
    @keyframes pop {
      to { opacity: 1; transform: scale(1); }
    }

    /* Estilo Bot√≥n 3D Suave */
    .soft-btn {
      transition: all 0.1s;
      border-bottom-width: 6px;
    }
    .soft-btn:active {
      transform: translateY(4px);
      border-bottom-width: 2px;
    }
  </style>
</head>

<body class="bg-animated min-h-screen flex items-center justify-center p-4">

  <div class="max-w-xl w-full bg-white/80 backdrop-blur-md rounded-3xl shadow-2xl p-6 border-4 border-white/50 flex flex-col items-center">

    <div class="w-full flex justify-between items-center mb-6">
      <a href="../index.html" class="bg-white text-gray-500 hover:text-indigo-600 px-4 py-2 rounded-xl font-bold text-sm shadow-sm transition flex items-center gap-2">
        <span>‚¨Ö</span> Men√∫
      </a>
      <div class="bg-indigo-100 text-indigo-700 px-4 py-2 rounded-xl font-bold text-sm">
        <span id="levelTitle">Cargando...</span>
      </div>
    </div>

    <div class="mb-8 text-center relative w-full">
      <p class="text-gray-500 text-sm font-bold uppercase tracking-widest mb-4">Busca esta imagen</p>
      
      <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-32 bg-indigo-300 rounded-full blur-xl opacity-50"></div>
      
      <div id="targetImage" 
           class="floating-target text-7xl inline-block bg-white p-6 rounded-3xl shadow-xl border-4 border-indigo-100 relative z-10">
        </div>
    </div>

    <div class="w-full h-1 bg-gray-200 rounded-full mb-8 opacity-50"></div>

    <div id="imageGrid" class="grid w-full gap-4">
      </div>

  </div>

  <script>
    // --- SONIDO (AudioContext) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
      if (audioCtx.state === 'suspended') audioCtx.resume();
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      const now = audioCtx.currentTime;

      if (type === 'success') {
        // Sonido de "Campanita" agudo
        osc.type = 'sine';
        osc.frequency.setValueAtTime(500, now);
        osc.frequency.exponentialRampToValueAtTime(800, now + 0.1);
        gain.gain.setValueAtTime(0.1, now);
        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
        osc.start(now);
        osc.stop(now + 0.3);
      } else {
        // Sonido suave de error
        osc.type = 'triangle';
        osc.frequency.setValueAtTime(150, now);
        osc.frequency.linearRampToValueAtTime(100, now + 0.2);
        gain.gain.setValueAtTime(0.1, now);
        gain.gain.linearRampToValueAtTime(0.01, now + 0.2);
        osc.start(now);
        osc.stop(now + 0.2);
      }
    }

    // --- CONFIGURACI√ìN ---
    const emojis = [
      "üê∂","üê±","üê≠","üêπ","ü¶ä","üêª","üêº","üê®",
      "üêØ","ü¶Å","üêÆ","üê∑","üê∏","üêµ","üêî","üêß",
      "üê¢","üêô","üê≥","ü¶ã","üêù","üêû","üêú","üêå"
    ];

    const levels = [
      { name: "Explorador", items: 4 }, // Grid 2x2
      { name: "Detective", items: 6 },  // Grid 3x2
      { name: "Maestro", items: 9 }     // Grid 3x3
    ];

    let currentLevel = 0;
    let correctEmoji = "";

    const levelTitle = document.getElementById("levelTitle");
    const targetImage = document.getElementById("targetImage");
    const imageGrid = document.getElementById("imageGrid");

    // --- INICIAR NIVEL ---
    function startLevel() {
      const { name, items } = levels[currentLevel];
      levelTitle.textContent = `Nivel ${currentLevel + 1}: ${name}`;

      // L√≥gica de selecci√≥n (Optimizada)
      const shuffledAll = shuffle([...emojis]);
      
      // El objetivo
      correctEmoji = shuffledAll[0]; 
      targetImage.innerHTML = correctEmoji;

      // Las opciones (Objetivo + (items-1) distractores)
      const distractors = shuffledAll.slice(1, items);
      let options = [correctEmoji, ...distractors];
      
      // Barajar las opciones para que el objetivo no est√© siempre primero
      options = shuffle(options);

      renderGrid(options);
    }

    // --- RENDERIZAR GRID ---
    function renderGrid(options) {
      imageGrid.innerHTML = "";
      
      // Ajuste din√°mico de columnas seg√∫n cantidad
      let cols = 2;
      if (options.length > 4) cols = 3;
      
      imageGrid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

      options.forEach((option, index) => {
        const btn = document.createElement("button");
        btn.innerHTML = option;

        // Estilos: Soft Button + Animaci√≥n de entrada
        btn.className = `
          soft-btn pop-in
          text-5xl md:text-6xl bg-white border-b-indigo-200 border-indigo-100 
          hover:bg-indigo-50 hover:border-indigo-300
          border-4 rounded-2xl py-4 w-full shadow-sm
          focus:outline-none cursor-pointer select-none
        `;
        
        // Retraso en la animaci√≥n para efecto cascada
        btn.style.animationDelay = `${index * 50}ms`;

        btn.onclick = () => checkAnswer(option, btn);
        imageGrid.appendChild(btn);
      });
    }

    // --- VERIFICAR ---
    function checkAnswer(selected, btnElement) {
      if (selected === correctEmoji) {
        // CORRECTO
        playSound('success');
        
        // Confeti desde el bot√≥n presionado
        const rect = btnElement.getBoundingClientRect();
        // Normalizamos coordenadas para confetti (0 a 1)
        const x = (rect.left + rect.width / 2) / window.innerWidth;
        const y = (rect.top + rect.height / 2) / window.innerHeight;

        confetti({
          particleCount: 100,
          spread: 60,
          origin: { x: x, y: y }
        });

        Swal.fire({
          title: "¬°Lo encontraste! üåü",
          text: "¬°Excelente trabajo!",
          icon: "success",
          confirmButtonText: "Siguiente",
          confirmButtonColor: "#6366f1",
          timer: 2000,
          timerProgressBar: true
        }).then(() => nextLevel());

      } else {
        // INCORRECTO
        playSound('error');
        
        // Animaci√≥n de error en el bot√≥n
        btnElement.classList.add('bg-red-50', 'border-red-200');
        btnElement.classList.add('animate-pulse'); // Tailwind pulse
        
        const Toast = Swal.mixin({
          toast: true,
          position: 'top-end',
          showConfirmButton: false,
          timer: 1500
        });
        Toast.fire({
          icon: 'error',
          title: 'Esa no es... busca la imagen de arriba üëÜ'
        });

        // Quitar el rojo despu√©s de un rato
        setTimeout(() => {
          btnElement.classList.remove('bg-red-50', 'border-red-200', 'animate-pulse');
        }, 500);
      }
    }

    // --- SIGUIENTE NIVEL ---
    function nextLevel() {
      currentLevel++;
      if (currentLevel < levels.length) {
        startLevel();
      } else {
        endGame();
      }
    }

    // --- FIN DEL JUEGO ---
    function endGame() {
      confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
      Swal.fire({
        title: "¬°Misi√≥n Cumplida! üïµÔ∏è‚Äç‚ôÇÔ∏è",
        html: "Has encontrado todas las im√°genes.<br>¬°Eres un gran observador!",
        icon: "success",
        confirmButtonText: "Volver al Men√∫",
        confirmButtonColor: "#10b981"
      }).then(() => {
        window.location.href = "../index.html";
      });
    }

    // --- UTILIDAD: BARAJAR ---
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Iniciar
    startLevel();
  </script>

</body>
</html>