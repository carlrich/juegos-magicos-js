<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Arma el Rostro</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/default.css">
  <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/scroll-behaviour.min.js"></script>
  <script>
    MobileDragDrop.polyfill({
      dragImageTranslateOverride: MobileDragDrop.scrollBehaviour.scrollBehaviourDragImageTranslateOverride
    });
  </script>

  <style>
    body { font-family: 'Fredoka', sans-serif; }

    .soft-bg {
      background-color: #fff1f2; /* Rosa muy p√°lido */
      background-image: radial-gradient(#fda4af 1px, transparent 1px);
      background-size: 30px 30px;
    }

    /* --- EL ROSTRO BASE --- */
    .face-container {
      position: relative;
      width: 320px;  /* Ajustado al ancho aprox de la imagen */
      height: 320px; /* Ajustado a la altura de la cabeza */
      /* AQU√ç VA TU IMAGEN DE FONDO */
      background-image: url('./rostro.png'); 
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      margin: 0 auto;
      /* Borde suave opcional para enmarcar si la imagen es transparente */
      filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1)); 
    }

    /* --- ZONAS DE DESTINO (Ajustadas a la imagen de la ni√±a) --- */
    .drop-zone {
      position: absolute;
      /* border: 2px dashed rgba(255, 0, 0, 0.3); /* Descomenta esto para VER las zonas y ajustarlas */
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s;
    }
    .drop-zone.hovered {
      background-color: rgba(255, 255, 255, 0.4);
      box-shadow: 0 0 10px #f43f5e;
    }

    /* Coordenadas espec√≠ficas para ESTE rostro */
    #zone-eyes { 
        top: 140px; 
        left: 60px; 
        width: 200px; 
        height: 70px; 
        z-index: 10;
    }
    #zone-nose { 
        top: 200px; 
        left: 135px; 
        width: 50px; 
        height: 50px; 
        z-index: 10;
    }
    #zone-mouth { 
        top: 240px; 
        left: 110px; 
        width: 100px; 
        height: 60px; 
        z-index: 10;
    }

    /* --- PIEZAS --- */
    .face-part {
      width: 90px;
      height: 90px;
      border-radius: 15px;
      background-color: white;
      border: 3px solid #fecdd3;
      cursor: grab;
      transition: transform 0.2s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 5px;
    }
    .face-part img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      pointer-events: none;
    }
    .face-part:active {
      cursor: grabbing;
      transform: scale(1.1);
    }
    
    /* Estilo cuando la pieza ya est√° colocada en la cara */
    .face-part.placed {
      cursor: default;
      width: 100%;
      height: 100%;
      border: none;
      background: transparent;
      box-shadow: none;
      border-radius: 0;
    }
    /* Ajuste fino para que las im√°genes llenen bien la zona al soltarlas */
    .face-part.placed img {
        width: 100%; 
        height: 100%;
        object-fit: contain; 
    }

  </style>
</head>

<body class="soft-bg min-h-screen flex flex-col items-center justify-center p-4">

  <div class="w-full max-w-4xl flex justify-between items-center mb-8">
    <a href="../index.html" class="bg-white hover:bg-rose-50 text-rose-600 px-4 py-2 rounded-xl font-bold shadow-sm transition flex items-center gap-2 text-sm">
      ‚¨Ö Salir
    </a>
    <h1 class="text-2xl font-bold text-rose-700 bg-white/80 px-6 py-2 rounded-full backdrop-blur shadow-sm">
      Arma el Rostro üëßüèª
    </h1>
    <div class="w-20"></div>
  </div>

  <div class="flex flex-col md:flex-row items-center justify-center gap-12 w-full max-w-5xl">
    
    <div class="face-container" id="faceContainer">
      <div class="drop-zone" id="zone-eyes" data-part="eyes"></div>
      <div class="drop-zone" id="zone-nose" data-part="nose"></div>
      <div class="drop-zone" id="zone-mouth" data-part="mouth"></div>
    </div>

    <div class="bg-white/70 backdrop-blur-md rounded-3xl p-8 border-4 border-rose-200 shadow-xl flex flex-col items-center">
      <p class="text-rose-500 font-bold uppercase text-xs tracking-widest mb-4">Arrastra las partes</p>
      
      <div id="partsContainer" class="flex gap-4 flex-wrap justify-center">
        </div>
    </div>

  </div>

  <script>
    // --- SONIDO Y VOZ ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const synth = window.speechSynthesis;

    function playSound(type) {
      if (audioCtx.state === 'suspended') audioCtx.resume();
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain); gain.connect(audioCtx.destination);
      const now = audioCtx.currentTime;

      if (type === 'pop') {
        osc.frequency.setValueAtTime(400, now);
        gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.1);
        osc.start(now); osc.stop(now + 0.1);
      } else if (type === 'success') {
        osc.type = 'triangle'; 
        osc.frequency.setValueAtTime(500, now); osc.frequency.linearRampToValueAtTime(800, now + 0.3);
        gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.5);
        osc.start(now); osc.stop(now + 0.5);
      }
    }

    function speak(text) {
      if (synth.speaking) synth.cancel();
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'es-ES'; utter.rate = 0.9;
      synth.speak(utter);
    }

    // --- DATOS DE LAS PARTES (RUTAS LOCALES) ---
    // Aseg√∫rate de que las im√°genes est√©n en la misma carpeta o ajusta la ruta
    const partsData = [
      { id: 'eyes', name: 'Ojos', img: './ojos.png' },
      { id: 'nose', name: 'Nariz', img: './nariz.png' },
      { id: 'mouth', name: 'Boca', img: './boca.png' }
    ];

    let correctCount = 0;

    // --- INICIALIZAR ---
    function initGame() {
      const container = document.getElementById("partsContainer");
      container.innerHTML = "";
      
      // Desordenar un poco las piezas
      const shuffledParts = [...partsData].sort(() => Math.random() - 0.5);

      shuffledParts.forEach(part => {
        const piece = document.createElement("div");
        piece.className = "face-part";
        piece.draggable = true;
        piece.dataset.part = part.id;
        piece.id = `piece-${part.id}`;
        
        // Imagen dentro de la pieza
        piece.innerHTML = `<img src="${part.img}" alt="${part.name}">`;

        // Eventos Drag
        piece.addEventListener("dragstart", e => {
          playSound('pop');
          speak(part.name); // Dice "Ojos" al agarrar
          e.dataTransfer.setData("part", part.id);
          e.dataTransfer.setData("id", piece.id);
          setTimeout(() => piece.classList.add('opacity-50'), 0);
        });
        piece.addEventListener("dragend", () => piece.classList.remove('opacity-50'));

        container.appendChild(piece);
      });
    }

    // --- L√ìGICA DROP ---
    document.querySelectorAll('.drop-zone').forEach(zone => {
      zone.addEventListener('dragover', e => {
        e.preventDefault();
        if (!zone.hasChildNodes()) zone.classList.add('hovered');
      });

      zone.addEventListener('dragleave', () => zone.classList.remove('hovered'));

      zone.addEventListener('drop', e => {
        e.preventDefault();
        zone.classList.remove('hovered');

        if (zone.hasChildNodes()) return;

        const draggedPartId = e.dataTransfer.getData('part');
        const draggedElementId = e.dataTransfer.getData('id');
        const targetPartId = zone.dataset.part;

        if (draggedPartId === targetPartId) {
          // --- CORRECTO ---
          playSound('success');
          
          const originalPiece = document.getElementById(draggedElementId);
          const partData = partsData.find(p => p.id === draggedPartId);
          
          speak(`¬°Muy bien! ${partData.name}`); 

          // Transformar la pieza para que encaje en la cara
          originalPiece.classList.add('placed');
          originalPiece.draggable = false;
          
          zone.appendChild(originalPiece);
          
          correctCount++;
          if(correctCount === partsData.length) {
            setTimeout(victory, 1000);
          }

        } else {
          // --- INCORRECTO ---
          playSound('pop'); // Sonido simple
          speak("Intenta de nuevo");
        }
      });
    });

    function victory() {
      confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
      Swal.fire({
        title: "¬°Qu√© linda! üòç",
        text: "Has completado el rostro correctamente.",
        imageUrl: './rostro.png', // Muestra la cara base en la alerta (opcional)
        imageHeight: 100,
        icon: "success",
        confirmButtonText: "Jugar otra vez",
        confirmButtonColor: "#f43f5e"
      }).then(() => window.location.reload());
    }

    initGame();
  </script>
</body>
</html>